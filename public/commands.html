


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rover Command Control</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --dark: #1e293b;
      --light: #f8fafc;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --card-bg: #ffffff;
      --sidebar-width: 250px;
      --transition: all 0.3s ease;
    }

    body {
      display: flex;
      background-color: #f0f4f8;
      color: var(--dark);
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--dark);
      color: var(--light);
      padding: 20px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
      transition: var(--transition);
    }

    .sidebar h1 {
      font-size: 24px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      color: white;
    }

    .sidebar h1 i {
      margin-right: 10px;
      font-size: 28px;
      color: var(--primary);
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar li {
      margin: 8px 0;
      border-radius: 8px;
      transition: var(--transition);
    }

    .sidebar li a {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      color: #94a3b8;
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }

    .sidebar li a i {
      margin-right: 10px;
      font-size: 18px;
    }

    .sidebar li.active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .sidebar li.active a {
      color: white;
    }

    .sidebar li:hover a {
      color: white;
    }

    .toggle-sidebar {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 200;
      background: var(--primary);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    main {
      flex-grow: 1;
      padding: 30px;
      margin-left: var(--sidebar-width);
      overflow-y: auto;
      height: 100vh;
      transition: var(--transition);
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .page-header h2 {
      font-size: 28px;
      font-weight: 600;
    }

    .control-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .control-section, .command-history {
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      padding: 25px;
    }

    .section-header {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Joystick styles */
    .joystick-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
    }

    .joystick {
      position: relative;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background-color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .joystick-inner {
      position: relative;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--primary);
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: transform 0.1s ease;
      user-select: none;
    }

    .joystick-inner:active {
      cursor: grabbing;
    }

    .joystick-feedback {
      text-align: center;
      font-size: 16px;
      margin-top: 10px;
    }

    .joystick-position {
      font-weight: bold;
      color: var(--primary);
    }

    .joystick-directions {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .direction-marker {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--dark);
      font-weight: 500;
    }

    .direction-marker.forward {
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
    }

    .direction-marker.backward {
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
    }

    .direction-marker.left {
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .direction-marker.right {
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* Speed control styles */
    .speed-control {
      margin-top: 30px;
      text-align: center;
    }

    .speed-slider-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 15px;
    }

    .speed-icon {
      font-size: 18px;
      color: var(--dark);
    }

    .speed-slider {
      flex-grow: 1;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: #e2e8f0;
      border-radius: 3px;
      outline: none;
    }

    .speed-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }

    .speed-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      border: none;
    }

    .speed-value {
      font-weight: bold;
      color: var(--primary);
      width: 40px;
    }

    /* Quick commands section */
    .quick-commands {
      margin-top: 30px;
    }

    .command-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 15px;
    }

    .command-btn {
      padding: 12px;
      border: none;
      border-radius: 8px;
      background-color: #f1f5f9;
      color: var(--dark);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .command-btn:hover {
      background-color: #e2e8f0;
    }

    .command-btn.primary {
      background-color: var(--primary);
      color: white;
    }

    .command-btn.primary:hover {
      background-color: var(--primary-hover);
    }

    .command-btn.warning {
      background-color: var(--warning);
      color: white;
    }

    .command-btn.warning:hover {
      background-color: #d97706;
    }

    .command-btn.danger {
      background-color: var(--danger);
      color: white;
    }

    .command-btn.danger:hover {
      background-color: #dc2626;
    }

    /* Command history section */
    .command-log {
      height: 400px;
      overflow-y: auto;
      background-color: #f8fafc;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .log-entry {
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
    }

    .log-time {
      color: #64748b;
      font-size: 12px;
    }

    .log-command {
      font-weight: bold;
      color: var(--primary);
    }

    .command-form {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .command-input {
      flex-grow: 1;
      padding: 10px 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: var(--transition);
    }

    .command-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }

    .send-btn {
      padding: 10px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .send-btn:hover {
      background-color: var(--primary-hover);
    }

    /* Status indicator */
    .rover-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status-circle {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--success);
    }

    /* Modal for command info */
    .command-info-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: var(--card-bg);
      margin: 10% auto;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      width: 80%;
      max-width: 600px;
    }

    .close-modal {
      color: #64748b;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close-modal:hover {
      color: var(--dark);
    }

    .modal-header {
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 600;
    }

    .command-info-list {
      margin-top: 15px;
    }

    .command-info-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }

    .command-info-item h4 {
      font-size: 16px;
      margin-bottom: 5px;
      color: var(--primary);
    }

    .command-info-item p {
      font-size: 14px;
      color: #64748b;
    }

    /* Responsive styles */
    @media (max-width: 1024px) {
      .control-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      main {
        margin-left: 0;
      }
      
      .toggle-sidebar {
        display: flex;
      }
      
      body.sidebar-open .sidebar {
        transform: translateX(0);
      }
      
      body.sidebar-open main {
        margin-left: 0;
      }
      
      .command-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <button class="toggle-sidebar" id="toggleSidebar">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Sidebar -->
  <aside class="sidebar">
    <h1><i class="fas fa-rocket"></i> Rover Command</h1>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> Dashboard</a></li>
      <li class="active"><a href="commands.html"><i class="fas fa-terminal"></i> Commands</a></li>
      <li><a href="camera.html"><i class="fas fa-camera"></i> Camera</a></li>
      <li><a href="map.html"><i class="fas fa-map-marker-alt"></i> Navigation</a></li>
      <li><a href="data.html"><i class="fas fa-chart-line"></i> Data Analysis</a></li>
      <li><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
      <li><a href="logout.html"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main>
    <div class="page-header">
      <h2>Rover Command Control</h2>
      <div class="rover-status">
        <span class="status-circle"></span>
        <span>Connected</span>
      </div>
    </div>

    <div class="control-container">
      <div class="control-section">
        <h3 class="section-header"><i class="fas fa-gamepad"></i> Movement Controls</h3>
        
        <!-- Joystick Control -->
        <div class="joystick-container">
          <div class="joystick" id="joystick">
            <div class="joystick-directions">
              <div class="direction-marker forward">Forward</div>
              <div class="direction-marker backward">Backward</div>
              <div class="direction-marker left">Left</div>
              <div class="direction-marker right">Right</div>
            </div>
            <div class="joystick-inner" id="joystickHandle">
              <i class="fas fa-arrows-alt"></i>
            </div>
          </div>
          <div class="joystick-feedback">
            Position: <span class="joystick-position" id="joystickPosition">Idle</span>
          </div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control">
          <h4>Speed Control</h4>
          <div class="speed-slider-container">
            <span class="speed-icon"><i class="fas fa-tachometer-alt"></i></span>
            <input type="range" min="1" max="10" value="5" class="speed-slider" id="speedSlider">
            <span class="speed-value" id="speedValue">5</span>
          </div>
        </div>

        <!-- Quick Commands -->
        <div class="quick-commands">
          <h4>Quick Commands</h4>
          <div class="command-grid">
            <button class="command-btn" id="cmdStop"><i class="fas fa-stop"></i> Stop</button>
            <button class="command-btn" id="cmdRotate"><i class="fas fa-sync"></i> Rotate 360°</button>
            <button class="command-btn primary" id="cmdSample"><i class="fas fa-vial"></i> Collect Sample</button>
            <button class="command-btn" id="cmdScan"><i class="fas fa-search"></i> Scan Surroundings</button>
            <button class="command-btn" id="cmdReturn"><i class="fas fa-home"></i> Return Home</button>
            <button class="command-btn danger" id="cmdEmergency"><i class="fas fa-exclamation-triangle"></i> Emergency Stop</button>
          </div>
        </div>
      </div>

      <div class="command-history">
        <h3 class="section-header"><i class="fas fa-history"></i> Command History</h3>
        
        <div class="command-log" id="commandLog">
          <div class="log-entry">
            <span class="log-time">10:45:23</span> - <span class="log-command">MOVE_FORWARD</span> - Speed: 5, Duration: 2s
          </div>
          <div class="log-entry">
            <span class="log-time">10:44:12</span> - <span class="log-command">ROTATE_LEFT</span> - Angle: 45°
          </div>
          <div class="log-entry">
            <span class="log-time">10:42:05</span> - <span class="log-command">STOP</span> - Emergency stop triggered
          </div>
          <div class="log-entry">
            <span class="log-time">10:38:57</span> - <span class="log-command">COLLECT_SAMPLE</span> - Position: X:123, Y:456
          </div>
        </div>

        <form class="command-form" id="commandForm">
          <input type="text" class="command-input" id="commandInput" placeholder="Enter custom command...">
          <button type="submit" class="send-btn">Send</button>
        </form>
        
        <div style="margin-top: 15px; text-align: right;">
          <button class="command-btn" id="showCommandInfo">
            <i class="fas fa-info-circle"></i> Command Reference
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Command Info Modal -->
  <div class="command-info-modal" id="commandInfoModal">
    <div class="modal-content">
      <span class="close-modal" id="closeModal">&times;</span>
      <h3 class="modal-header">Command Reference</h3>
      <p>Here are the available commands and their syntax:</p>
      
      <div class="command-info-list">
        <div class="command-info-item">
          <h4>MOVE [direction] [speed] [duration]</h4>
          <p>Move the rover in a specified direction at a set speed for a duration.</p>
          <p>Example: MOVE FORWARD 5 2.5</p>
        </div>
        
        <div class="command-info-item">
          <h4>ROTATE [direction] [angle]</h4>
          <p>Rotate the rover in place by a specified angle.</p>
          <p>Example: ROTATE LEFT 90</p>
        </div>
        
        <div class="command-info-item">
          <h4>SAMPLE [type]</h4>
          <p>Collect a sample of specified type at the current location.</p>
          <p>Example: SAMPLE SOIL</p>
        </div>
        
        <div class="command-info-item">
          <h4>SCAN [mode]</h4>
          <p>Perform an environmental scan using specified sensor mode.</p>
          <p>Example: SCAN INFRARED</p>
        </div>
        
        <div class="command-info-item">
          <h4>STOP</h4>
          <p>Immediately stop all rover movement and operations.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const joystick = document.getElementById('joystick');
    const joystickHandle = document.getElementById('joystickHandle');
    const joystickPosition = document.getElementById('joystickPosition');
    const speedSlider = document.getElementById('speedSlider');
    const speedValue = document.getElementById('speedValue');
    const commandLog = document.getElementById('commandLog');
    const commandForm = document.getElementById('commandForm');
    const commandInput = document.getElementById('commandInput');
    const commandInfoModal = document.getElementById('commandInfoModal');
    const showCommandInfoBtn = document.getElementById('showCommandInfo');
    const closeModalBtn = document.getElementById('closeModal');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');

    // Quick command buttons
    const cmdStopBtn = document.getElementById('cmdStop');
    const cmdRotateBtn = document.getElementById('cmdRotate');
    const cmdSampleBtn = document.getElementById('cmdSample');
    const cmdScanBtn = document.getElementById('cmdScan');
    const cmdReturnBtn = document.getElementById('cmdReturn');
    const cmdEmergencyBtn = document.getElementById('cmdEmergency');

    // Joystick variables
    let isDragging = false;
    let joystickRect;
    let centerX, centerY;
    let maxDistance;
    const threshold = 0.2; // Threshold for activating movement
    let currentDirection = 'Idle';
    let currentX = 0;
    let currentY = 0;

    // Initialize joystick dimensions
    function initJoystick() {
      joystickRect = joystick.getBoundingClientRect();
      centerX = joystickRect.width / 2;
      centerY = joystickRect.height / 2;
      maxDistance = joystickRect.width / 2 - joystickHandle.offsetWidth / 2;
    }

    // Initialize the joystick when the page loads
    window.addEventListener('load', initJoystick);
    window.addEventListener('resize', initJoystick);

    // Joystick event handlers
    joystickHandle.addEventListener('mousedown', startDrag);
    joystickHandle.addEventListener('touchstart', startDrag);
    window.addEventListener('mousemove', drag);
    window.addEventListener('touchmove', drag);
    window.addEventListener('mouseup', stopDrag);
    window.addEventListener('touchend', stopDrag);

    // Speed slider event
    speedSlider.addEventListener('input', function() {
      speedValue.textContent = this.value;
    });

    // Toggle sidebar
    toggleSidebarBtn.addEventListener('click', function() {
      document.body.classList.toggle('sidebar-open');
    });

    // Form submission for custom commands
    commandForm.addEventListener('submit', function(e) {
      e.preventDefault();
      if (commandInput.value.trim() !== '') {
        sendCommand(commandInput.value);
        commandInput.value = '';
      }
    });

    // Modal controls
    showCommandInfoBtn.addEventListener('click', function() {
      commandInfoModal.style.display = 'block';
    });

    closeModalBtn.addEventListener('click', function() {
      commandInfoModal.style.display = 'none';
    });

    window.addEventListener('click', function(e) {
      if (e.target === commandInfoModal) {
        commandInfoModal.style.display = 'none';
      }
    });

    // Quick command button events
    cmdStopBtn.addEventListener('click', function() {
      sendCommand('STOP');
    });

    cmdRotateBtn.addEventListener('click', function() {
      sendCommand('ROTATE 360');
    });

    cmdSampleBtn.addEventListener('click', function() {
      sendCommand('SAMPLE COLLECT');
    });

    cmdScanBtn.addEventListener('click', function() {
      sendCommand('SCAN SURROUNDINGS');
    });

    cmdReturnBtn.addEventListener('click', function() {
      sendCommand('RETURN HOME');
    });

    cmdEmergencyBtn.addEventListener('click', function() {
      if (confirm('Are you sure you want to trigger an emergency stop?')) {
        sendCommand('EMERGENCY STOP');
      }
    });

    // Function to start dragging the joystick
    function startDrag(e) {
      isDragging = true;
      joystickHandle.style.transition = 'none';
      joystickRect = joystick.getBoundingClientRect();
      
      // Prevent default behavior for touch events
      if (e.type === 'touchstart') {
        e.preventDefault();
      }
    }

    // Function to handle dragging the joystick
    function drag(e) {
      if (!isDragging) return;
      
      let clientX, clientY;
      
      if (e.type === 'touchmove') {
        e.preventDefault();
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      
      // Calculate position relative to joystick center
      const relX = clientX - joystickRect.left - centerX;
      const relY = clientY - joystickRect.top - centerY;
      
      // Calculate distance from center
      const distance = Math.sqrt(relX * relX + relY * relY);
      
      // Normalize to max distance
      const normalizedDistance = Math.min(distance, maxDistance);
      const angle = Math.atan2(relY, relX);
      
      // Calculate new position
      const moveX = normalizedDistance * Math.cos(angle);
      const moveY = normalizedDistance * Math.sin(angle);
      
      // Update handle position
      joystickHandle.style.transform = `translate(${moveX}px, ${moveY}px)`;
      
      // Calculate movement direction
      if (normalizedDistance / maxDistance > threshold) {
        // Normalize to range -1 to 1
        currentX = moveX / maxDistance;
        currentY = moveY / maxDistance;
        
        // Determine direction based on angle
        const degrees = angle * (180 / Math.PI);
        
        if (degrees >= -45 && degrees < 45) {
          currentDirection = 'Right';
        } else if (degrees >= 45 && degrees < 135) {
          currentDirection = 'Down';
        } else if (degrees >= -135 && degrees < -45) {
          currentDirection = 'Up';
        } else {
          currentDirection = 'Left';
        }
        
        // Display movement info
        joystickPosition.textContent = `${currentDirection} (${currentX.toFixed(2)}, ${currentY.toFixed(2)})`;
        
        // Send movement command if direction changes
        sendMovementCommand(currentDirection, speedSlider.value);
      } else {
        currentDirection = 'Idle';
        currentX = 0;
        currentY = 0;
        joystickPosition.textContent = 'Idle';
        
        // Send stop command if was moving
        if (currentX !== 0 || currentY !== 0) {
          sendCommand('STOP');
        }
      }
    }

    // Function to stop dragging
    function stopDrag() {
      if (!isDragging) return;
      
      isDragging = false;
      
      // Reset handle position with animation
      joystickHandle.style.transition = 'transform 0.2s ease';
      joystickHandle.style.transform = 'translate(0px, 0px)';
      
      // Reset movement
      currentDirection = 'Idle';
      currentX = 0;
      currentY = 0;
      joystickPosition.textContent = 'Idle';
      
      // Send stop command
      sendCommand('STOP');
    }

    // Function to send movement commands based on joystick input
    function sendMovementCommand(direction, speed) {
      let command = '';
      
      switch(direction) {
        case 'Up':
          command = `MOVE FORWARD ${speed}`;
          break;
        case 'Down':
          command = `MOVE BACKWARD ${speed}`;
          break;
        case 'Left':
          command = `ROTATE LEFT ${speed}`;
          break;
        case 'Right':
          command = `ROTATE RIGHT ${speed}`;
          break;
        default:
          return; // No command for idle
      }
      
      // Rather than flooding the log, we would send this command to the rover
      // sendCommand(command); // Uncomment to send continuous commands
    }

    // Function to send commands and log them
    function sendCommand(command) {
      // In a real application, send to server or API
      console.log('Sending command:', command);
      
      // Get current time
      const now = new Date();
      const time = now.toLocaleTimeString();
      
      // Log the command
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      logEntry.innerHTML = `<span class="log-time">${time}</span> - <span class="log-command">${command.split(' ')[0]}</span> - ${command}`;
      
      // Add to log
      commandLog.insertBefore(logEntry, commandLog.firstChild);
      
      // Show notification
      showNotification(`Command sent: ${command}`);
    }

    // Simple notification function
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.bottom
    }